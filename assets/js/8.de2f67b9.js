(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{424:function(t,s,a){t.exports=a.p+"assets/img/docker_jx01.a8b666f0.png"},425:function(t,s,a){t.exports=a.p+"assets/img/docker_jx02.334e1af4.png"},426:function(t,s,a){t.exports=a.p+"assets/img/docker_jx03.b47e0278.png"},427:function(t,s,a){t.exports=a.p+"assets/img/docker_jx04.3b7fa4ca.png"},428:function(t,s,a){t.exports=a.p+"assets/img/docker_jx05.97615d24.png"},429:function(t,s,a){t.exports=a.p+"assets/img/docker_jx06.d1ae25fc.png"},430:function(t,s,a){t.exports=a.p+"assets/img/docker_jx07.3c744681.png"},431:function(t,s,a){t.exports=a.p+"assets/img/docker_jx08.50850d26.png"},432:function(t,s,a){t.exports=a.p+"assets/img/docker_jx09.0cbd99d9.png"},433:function(t,s,a){t.exports=a.p+"assets/img/docker_jx10.4eeca2f7.png"},434:function(t,s,a){t.exports=a.p+"assets/img/docker_jx11.ca3ebbfd.png"},559:function(t,s,a){"use strict";a.r(s);var e=a(14),r=Object(e.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h2",{attrs:{id:"简介"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#简介"}},[t._v("#")]),t._v(" 简介")]),t._v(" "),s("blockquote",[s("p",[t._v("是一种轻量级、可执行的独立软件包，它包含运行某个软件所需的所有内容，我们把应用程序和配置依赖打包好形成一个可交付的运行环境(包括代码、运行时需要的库、环境变量和配置文件等)，这个打包好的运行环境就是image镜像文件。\n只有通过这个镜像文件才能生成Docker容器实例(类似Java中new出来一个对象)。")])]),t._v(" "),s("h2",{attrs:{id:"分层的镜像"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#分层的镜像"}},[t._v("#")]),t._v(" 分层的镜像")]),t._v(" "),s("p",[t._v("下载镜像时分片下载的")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@localhost data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# docker pull tomcat ")]),t._v("\nUsing default tag: latest\nlatest: Pulling from library/tomcat\n0e29546d541c: Pull complete \n9b829c73b52b: Pull complete \ncb5b7ae36172: Pull complete \n6494e4811622: Pull complete \n668f6fcc5fa5: Pull complete \ndc120c3e0290: Pull complete \n8f7c0eebb7b1: Pull complete \n77b694f83996: Pull complete \n0f611256ec3a: Pull complete \n4f25def12f23: Pull complete \nDigest: sha256:9dee185c3b161cdfede1f5e35e8b56ebc9de88ed3a79526939701f3537a52324\nStatus: Downloaded newer image "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" tomcat:latest\ndocker.io/library/tomcat:latest\n")])])]),s("h2",{attrs:{id:"unionfs-联合文件系统"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#unionfs-联合文件系统"}},[t._v("#")]),t._v(" UnionFS（联合文件系统）")]),t._v(" "),s("p",[t._v("UnionFS（联合文件系统）：Union文件系统（UnionFS）是一种分层、轻量级并且高性能的文件系统，它支持对文件系统的修改作为一次提交来一层层的叠加，同时可以将不同目录挂载到同一个虚拟文件系统下(unite several directories into a single virtual filesystem)。Union 文件系统是 Docker 镜像的基础。镜像可以通过分层来进行继承，基于基础镜像（没有父镜像），可以制作各种具体的应用镜像。")]),t._v(" "),s("h2",{attrs:{id:"docker镜像加载原理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#docker镜像加载原理"}},[t._v("#")]),t._v(" Docker镜像加载原理")]),t._v(" "),s("p",[t._v("docker的镜像实际上由一层一层的文件系统组成，这种层级的文件系统UnionFS。")]),t._v(" "),s("p",[s("strong",[t._v("bootfs")]),t._v("(boot file system)主要包含bootloader和kernel, bootloader主要是引导加载kernel, Linux刚启动时会加载bootfs文件系统，在Docker镜像的最底层是引导文件系统bootfs。这一层与我们典型的Linux/Unix系统是一样的，包含boot加载器和内核。当boot加载完成之后整个内核就都在内存中了，此时内存的使用权已由bootfs转交给内核，此时系统也会卸载bootfs。")]),t._v(" "),s("p",[s("strong",[t._v("rootfs")]),t._v("(root file system) ，在bootfs之上。包含的就是典型 Linux 系统中的 /dev, /proc, /bin, /etc 等标准目录和文件。rootfs就是各种不同的操作系统发行版，比如Ubuntu，Centos等等。")]),t._v(" "),s("p",[s("img",{attrs:{src:a(424),alt:""}})]),t._v(" "),s("p",[t._v("平时我们安装进虚拟机的CentOS都是好几个G，为什么docker这里才200M？？")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@localhost data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# docker images centos")]),t._v("\nREPOSITORY   TAG       IMAGE ID       CREATED         SIZE\ncentos       latest    5d0da3dc9764   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("21")]),t._v(" months ago   231MB\n")])])]),s("p",[t._v("对于一个精简的OS，rootfs可以很小，只需要包括最基本的命令、工具和程序库就可以了，因为底层直接用Host的kernel，自己只需要提供 rootfs 就行了。由此可见对于不同的linux发行版, bootfs基本是一致的, rootfs会有差别, 因此不同的发行版可以公用bootfs。")]),t._v(" "),s("p",[s("strong",[t._v("为什么docker镜像采用这种分层结构？")])]),t._v(" "),s("p",[t._v("镜像分层最大的一个好处就是共享资源，方便复制迁移，就是为了复用。")]),t._v(" "),s("p",[t._v("比如说有多个镜像都从相同的 base 镜像构建而来，那么 Docker Host 只需在磁盘上保存一份 base 镜像；")]),t._v(" "),s("p",[t._v("同时内存中也只需加载一份 base 镜像，就可以为所有容器服务了。而且镜像的每一层都可以被共享。")]),t._v(" "),s("p",[s("strong",[t._v("容器层与镜像层")])]),t._v(" "),s("p",[t._v("当容器启动时，一个新的可写层被加载到镜像的顶部。这一层通常被称作“容器层”，“容器层”之下的都叫“镜像层”。")]),t._v(" "),s("p",[t._v("所有对容器的改动 - 无论添加、删除、还是修改文件都只会发生在容器层中。只有容器层是可写的，容器层下面的所有镜像层都是只读的")]),t._v(" "),s("p",[s("img",{attrs:{src:a(425),alt:""}})]),t._v(" "),s("h2",{attrs:{id:"镜像commit"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#镜像commit"}},[t._v("#")]),t._v(" 镜像commit")]),t._v(" "),s("p",[t._v("docker commit提交容器副本使之成为一个新的镜像")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" commit "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-m")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"add vim cmd"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-a")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"作者名称"')]),t._v(" 容器ID 要创建的目标镜像名称:"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("版本号"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),s("p",[t._v("Docker中的镜像分层，支持通过扩展现有镜像，创建新的镜像。类似Java继承于一个Base基础类，自己再按需扩展。")]),t._v(" "),s("p",[t._v("新镜像是从 base 镜像一层一层叠加生成的。每安装一个软件，就在现有镜像的基础上增加一层")]),t._v(" "),s("p",[s("img",{attrs:{src:a(426),alt:""}})]),t._v(" "),s("h2",{attrs:{id:"细说export、commit和save命令"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#细说export、commit和save命令"}},[t._v("#")]),t._v(" 细说Export、Commit和Save命令")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://zhuanlan.zhihu.com/p/152219012?utm_id=0",target:"_blank",rel:"noopener noreferrer"}},[t._v("连接"),s("OutboundLink")],1)]),t._v(" "),s("h2",{attrs:{id:"本地镜像发布到阿里云"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#本地镜像发布到阿里云"}},[t._v("#")]),t._v(" 本地镜像发布到阿里云")]),t._v(" "),s("h3",{attrs:{id:"生成镜像的方法"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#生成镜像的方法"}},[t._v("#")]),t._v(" 生成镜像的方法")]),t._v(" "),s("p",[t._v("方式一：")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" commit "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-m")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"add vim cmd"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-a")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"作者名称"')]),t._v(" 容器ID 要创建的目标镜像名称:"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("版本号"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),s("p",[t._v("方式二：\nDockerFile")]),t._v(" "),s("h3",{attrs:{id:"发布流程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#发布流程"}},[t._v("#")]),t._v(" 发布流程")]),t._v(" "),s("p",[s("img",{attrs:{src:a(427),alt:""}})]),t._v(" "),s("h3",{attrs:{id:"发布步骤"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#发布步骤"}},[t._v("#")]),t._v(" 发布步骤")]),t._v(" "),s("p",[s("strong",[t._v("配置阿里云镜像")])]),t._v(" "),s("p",[t._v("配置步骤请观察前面安装步骤")]),t._v(" "),s("p",[s("strong",[t._v("创建实例")])]),t._v(" "),s("ol",[s("li",[s("p",[t._v("创建“个人实例”\n"),s("img",{attrs:{src:a(428),alt:""}})])]),t._v(" "),s("li",[s("p",[t._v("创建命名空间，并且设置为公有\n"),s("img",{attrs:{src:a(429),alt:""}})])])]),t._v(" "),s("p",[s("img",{attrs:{src:a(430),alt:""}})]),t._v(" "),s("ol",{attrs:{start:"3"}},[s("li",[s("p",[t._v("创建镜像仓库，并且设置为公有\n"),s("img",{attrs:{src:a(431),alt:""}})])]),t._v(" "),s("li",[s("p",[t._v("查看推送脚本\n"),s("img",{attrs:{src:a(432),alt:""}})])])]),t._v(" "),s("p",[s("img",{attrs:{src:a(433),alt:""}})]),t._v(" "),s("ol",{attrs:{start:"5"}},[s("li",[t._v("推送")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("\n$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" login "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--username")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("阿里云账号 registry.cn-hangzhou.aliyuncs.com\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 给某个镜像打标签，生成一个新的镜像，生成的镜像名称必须是这种格式：注册的namespace/注册的仓库名称")]),t._v("\n$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" tag "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("ImageId"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" registry.cn-hangzhou.aliyuncs.com/注册的namespace/注册的仓库名称:"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("需要推送的镜像版本"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 将刚才新生成的镜像推送到阿里云")]),t._v("\n$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" push registry.cn-hangzhou.aliyuncs.com/注册的namespace/注册的仓库名称:"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("需要推送的镜像版本"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),s("ol",{attrs:{start:"6"}},[s("li",[t._v("测试推送的镜像")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 拉取推送的镜像")]),t._v("\n$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" pull registry.cn-hangzhou.aliyuncs.com/注册的namespace/注册的仓库名称:1.1\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 继续进入centos看是否和push的一致")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n")])])]),s("h2",{attrs:{id:"本地镜像发布到私有库"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#本地镜像发布到私有库"}},[t._v("#")]),t._v(" 本地镜像发布到私有库")]),t._v(" "),s("h3",{attrs:{id:"私有库"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#私有库"}},[t._v("#")]),t._v(" 私有库")]),t._v(" "),s("p",[t._v("公有库："),s("a",{attrs:{href:"https://hub.docker.com/",target:"_blank",rel:"noopener noreferrer"}},[t._v("官方Docker Hub地址"),s("OutboundLink")],1),t._v("，国内访问太慢了且准备被阿里云、网易等取代的趋势，不太主流")]),t._v(" "),s("p",[t._v("私有库：涉密的公司不会提供镜像给公网，所以需要创建本地私人仓库供团队使用，基于公司内部项目构建镜像。")]),t._v(" "),s("p",[t._v("Docker Registry：官方提供的工具，用于构建私有镜像仓库。")]),t._v(" "),s("h3",{attrs:{id:"发布流程-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#发布流程-2"}},[t._v("#")]),t._v(" 发布流程")]),t._v(" "),s("p",[s("img",{attrs:{src:a(434),alt:""}})]),t._v(" "),s("h3",{attrs:{id:"发布步骤-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#发布步骤-2"}},[t._v("#")]),t._v(" 发布步骤")]),t._v(" "),s("ol",[s("li",[t._v("下载镜像Docker Registry")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" pull registry\n")])])]),s("ol",{attrs:{start:"2"}},[s("li",[s("p",[t._v("运行Registry私有库，相当于本地有个私有Docker Hub")])]),t._v(" "),s("li",[s("p",[t._v("默认情况，仓库被创建在容器的/var/lib/registry目录下，建议自行用容器卷映射，方便于宿主机联调")])])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-d")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-p")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5000")]),t._v(":5000  "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-v")]),t._v(" /data/myregistry/:/tmp/registry "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--privileged")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("true registry\n")])])]),s("ol",{attrs:{start:"4"}},[s("li",[t._v("将修改过的镜像打包")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@localhost myregistry"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# docker commit -m="add test txt" -a="tx" ea967d78dda3 with_test_centos:1.1')]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@localhost myregistry"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# docker images -a")]),t._v("\nREPOSITORY                        TAG       IMAGE ID       CREATED         SIZE\nwith_test_centos                  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.1")]),t._v("       19833c3e6827   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),t._v(" minutes ago   231MB\ntomcat                            latest    fb5657adc892   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("18")]),t._v(" months ago   680MB\nregistry                          latest    b8604a3fe854   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("19")]),t._v(" months ago   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("26")]),t._v(".2MB\ncentos                            latest    5d0da3dc9764   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("21")]),t._v(" months ago   231MB\nredis                             "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("6.0")]),t._v(".8     16ecd2772934   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" years ago     104MB\n\n")])])]),s("ol",{attrs:{start:"5"}},[s("li",[t._v("查询私有库上的镜像")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@localhost myregistry"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# curl -X GET '127.0.0.1:5000/v2/_catalog'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"repositories"')]),t._v(":"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("ol",{attrs:{start:"6"}},[s("li",[t._v("打TAG，将镜像with_test_centos:1.1修改为127.0.0.1:5000/with_test_centos:1.1")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@localhost myregistry"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# docker tag 19833c3e6827 127.0.0.1:5000/with_test_centos:1.1")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@localhost myregistry"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# docker images -a")]),t._v("\nREPOSITORY                        TAG       IMAGE ID       CREATED         SIZE\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.1:5000/with_test_centos   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.1")]),t._v("       19833c3e6827   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),t._v(" minutes ago   231MB\nwith_test_centos                  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.1")]),t._v("       19833c3e6827   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),t._v(" minutes ago   231MB\ntomcat                            latest    fb5657adc892   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("18")]),t._v(" months ago   680MB\nregistry                          latest    b8604a3fe854   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("19")]),t._v(" months ago   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("26")]),t._v(".2MB\ncentos                            latest    5d0da3dc9764   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("21")]),t._v(" months ago   231MB\nredis                             "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("6.0")]),t._v(".8     16ecd2772934   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" years ago     104MB\n\n")])])]),s("ol",{attrs:{start:"7"}},[s("li",[t._v("修改"),s("code",[t._v("/etc/docker/daemon.json")]),t._v("，修改docker允许http推送镜像，docker默认不允许http方式推送镜像，通过配置选项来取消这个限制。")])]),t._v(" "),s("div",{staticClass:"language-json extra-class"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"registry-mirrors"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http://hub-mirror.c.163.com"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"insecure-registries"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"127.0.0.1:5000"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("ol",{attrs:{start:"8"}},[s("li",[t._v("重启服务")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("systemctl daemon-reload\nsystemctl restart "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 重新启动私有镜像")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-d")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-p")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5000")]),t._v(":5000  "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-v")]),t._v(" /data/myregistry/:/tmp/registry "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--privileged")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("true registry\n")])])]),s("ol",{attrs:{start:"9"}},[s("li",[t._v("推送")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@localhost myregistry"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# docker push 127.0.0.1:5000/with_test_centos:1.1")]),t._v("\nThe push refers to repository "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.1:5000/with_test_centos"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n17da8dfe35c6: Pushed \n74ddd0ec08fa: Pushed \n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.1")]),t._v(": digest: sha256:42d5d4b76ff3abaa02ffbe60259d644e7aec5f8b3c42ebff313f9b1a9ea1d03c size: "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("736")]),t._v("\n")])])]),s("ol",{attrs:{start:"10"}},[s("li",[t._v("测试")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@localhost myregistry"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#  curl -X GET '127.0.0.1:5000/v2/_catalog'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"repositories"')]),t._v(":"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"with_test_centos"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])])}),[],!1,null,null,null);s.default=r.exports}}]);