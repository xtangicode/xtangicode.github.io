(window.webpackJsonp=window.webpackJsonp||[]).push([[44],{460:function(s,t,a){"use strict";a.r(t);var n=a(14),e=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"简介"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#简介"}},[s._v("#")]),s._v(" 简介")]),s._v(" "),t("blockquote",[t("p",[s._v("一般使用 Elasticsearch 的时候，会使用 Query DSL 来查询数据，从 Elasticsearch6.3 版本以后，Elasticsearch 已经支持 SQL 查询了。")]),s._v(" "),t("p",[s._v("Elasticsearch SQL 是一个 X-Pack 组件，它允许针对 Elasticsearch 实时执行类似 SQL 的查询。无论使用 REST 接口，命令行还是 JDBC，任何客户端都可以使用 SQL 对 Elasticsearch中的数据进行原生搜索和聚合数据。可以将 Elasticsearch SQL 看作是一种翻译器，它可以将SQL 翻译成 Query DSL")])]),s._v(" "),t("p",[s._v("Elasticsearch SQL 具有如下特性：")]),s._v(" "),t("p",[s._v("（1）原生支持：Elasticsearch SQL 是专门为 Elasticsearch 打造的")]),s._v(" "),t("p",[s._v("（2）没有额外的零件：无需其他硬件，处理器，运行环境或依赖库即可查询 Elasticsearch，Elasticsearch SQL 直接在 Elasticsearch 内部运行")]),s._v(" "),t("p",[s._v("（3）轻巧高效：Elasticsearch SQL 并未抽象化其搜索功能，相反的它拥抱并接受了 SQL 来实现全文搜索，以简洁的方式实时运行全文搜索")]),s._v(" "),t("h2",{attrs:{id:"sql-和-elasticsearch-的对应关系"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#sql-和-elasticsearch-的对应关系"}},[s._v("#")]),s._v(" SQL 和 Elasticsearch 的对应关系")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("SQL")]),s._v(" "),t("th",[s._v("Elasticsearch")]),s._v(" "),t("th",[s._v("描述")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[s._v("Column")]),s._v(" "),t("td",[s._v("field")]),s._v(" "),t("td",[s._v("对比两个，数据都存储在命名条目中，具有多种数据类型，包含一个值。SQL 将此类条目称为列，而 Elasticsearch 称为字段。请注意，在 Elasticsearch 中，一个字段可以包含多个相同类型的值（本质上是一个列表），而在 SQL 中，一个列可以只包含一个所述类型的值。Elasticsearch SQL 将尽最大努力保留 SQL 语义，并根据查询拒绝那些返回具有多个值的字段的查询")])]),s._v(" "),t("tr",[t("td",[s._v("Row")]),s._v(" "),t("td",[s._v("Document")]),s._v(" "),t("td",[s._v("Columns 和 fields 本身不存在；它们是 row 或 a 的一部分 document。两者的语义略有不同：row 趋于严格（并且有更多的强制执行），而document 趋于更加灵活或松散（同时仍然具有结构）")])]),s._v(" "),t("tr",[t("td",[s._v("Table")]),s._v(" "),t("td",[s._v("Index")]),s._v(" "),t("td",[s._v("执行查询的目标")])]),s._v(" "),t("tr",[t("td",[s._v("Schema")]),s._v(" "),t("td",[s._v("Mapping")]),s._v(" "),t("td",[s._v("在 RDBMS 中，schem 主要是表的命名空间，通常用作安全边界。Elasticsearch 没有为它提供等效的概念。但是，当启用安全性时，Elasticsearch 会自动应用安全性强制，以便角色只能看到它被允许访问的数据")])]),s._v(" "),t("tr",[t("td",[s._v("Database")]),s._v(" "),t("td",[s._v("Cluster实例")]),s._v(" "),t("td",[s._v("在 SQL 中，catalog 或者 database 从概念上可以互换使用，表示一组模式，即多个表。在 Elasticsearch 中，可用的索引集被分组在一个cluster，语义也有所不同。database 本质上是另一个命名空间（可能对数据的存储方式有一些影响），而 Elasticsearch cluster 是一个运行时实例，或者更确切地说是一组至少一个 Elasticsearch 实例（通常是分布式运行）。在实践中，这意味着虽然在 SQL 中，一个实例中可能有多个目录，但在 Elasticsearch 中，一个目录仅限于一个")])])])]),s._v(" "),t("h2",{attrs:{id:"数据准备"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#数据准备"}},[s._v("#")]),s._v(" 数据准备")]),s._v(" "),t("div",{staticClass:"language-json extra-class"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[s._v("PUT my-sql-index\n# 创建索引并增加数据，等同于创建表和数据\nPUT my-sql-index/_bulk?refresh\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"index"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"_id"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"JAVA"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"name"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"JAVA"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"author"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"zhangsan"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"release_date"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2022-05-01"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"page_count"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("561")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"index"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"_id"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"BIGDATA"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"name"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"BIGDATA"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"author"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"lisi"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"release_date"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2022-05-02"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"page_count"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("482")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"index"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"_id"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"SCALA"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"name"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"SCALA"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"author"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"wangwu"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"release_date"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2022-05-03"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"page_count"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("604")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),t("h2",{attrs:{id:"sql查询"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#sql查询"}},[s._v("#")]),s._v(" SQL查询")]),s._v(" "),t("div",{staticClass:"language-json extra-class"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[s._v("# SQL\n# 这里的表就是索引\n# 可以通过 format 参数控制返回结果的格式，默认为 json 格式\n# txt"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("表示文本格式，看起来更直观点.\n# csv"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("使用逗号隔开的数据\n# json"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("JSON 格式数据\n# tsv"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" 使用 tab 键隔开数据\n# yaml"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("属性配置格式\nPOST _sql?format=txt\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"query"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('"\n SELECT * FROM '),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"my-sql-index"')]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('"\n'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n结果：\n    author     |     name      |  page_count   |      release_date      \n---------------+---------------+---------------+------------------------\nzhangsan       |JAVA           |"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("561")]),s._v("            |"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("-05")]),s._v("-01T00"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(".000Z\nlisi           |BIGDATA        |"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("482")]),s._v("            |"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("-05")]),s._v("-02T00"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(".000Z\nwangwu         |SCALA          |"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("604")]),s._v("            |"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("-05")]),s._v("-03T00"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(".000Z\n\n\n————————————————————————————————————————————————————————————————\n# 条件查询\nPOST _sql?format=txt\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"query"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('"\n SELECT * FROM '),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"my-sql-index"')]),s._v(" where page_count > "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("500")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('"\n'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n结果：\n    author     |     name      |  page_count   |      release_date      \n---------------+---------------+---------------+------------------------\nzhangsan       |JAVA           |"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("561")]),s._v("            |"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("-05")]),s._v("-01T00"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(".000Z\nwangwu         |SCALA          |"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("604")]),s._v("            |"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("-05")]),s._v("-03T00"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(".000Z\n\n")])])]),t("h2",{attrs:{id:"sql转为dsl"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#sql转为dsl"}},[s._v("#")]),s._v(" SQL转为DSL")]),s._v(" "),t("div",{staticClass:"language-json extra-class"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[s._v("# 转换 SQL 为 DSL 进行操作\nPOST _sql/translate\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"query"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('"\n SELECT * FROM '),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"my-sql-index"')]),s._v(" where page_count > "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("500")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('"\n'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n结果：\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"size"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"query"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"range"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"page_count"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"from"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("500")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"to"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token null keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"include_lower"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"include_upper"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"boost"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.0")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"_source"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"fields"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"field"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"author"')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"field"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name"')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"field"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"page_count"')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"field"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"release_date"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"format"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"strict_date_optional_time_nanos"')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"sort"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"_doc"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"order"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"asc"')]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),t("h2",{attrs:{id:"sql和dsl混用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#sql和dsl混用"}},[s._v("#")]),s._v(" SQL和DSL混用")]),s._v(" "),t("div",{staticClass:"language-json extra-class"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[s._v("# SQL 和 DSL 混合使用\n# 由于索引中含有横线，所以作为表名时需要采用双引号，且外层需要三个引号包含\nPOST _sql?format=txt\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"query"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('"SELECT * FROM '),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"my-sql-index"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('"'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"filter"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"range"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"page_count"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"gte"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("400")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"lte"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("600")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"fetch_size"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n结果：\n    author     |     name      |  page_count   |      release_date      \n---------------+---------------+---------------+------------------------\nzhangsan       |JAVA           |"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("561")]),s._v("            |"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("-05")]),s._v("-01T00"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(".000Z\nlisi           |BIGDATA        |"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("482")]),s._v("            |"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("-05")]),s._v("-02T00"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(".000Z\n")])])]),t("h2",{attrs:{id:"常用sql操作"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#常用sql操作"}},[s._v("#")]),s._v(" 常用SQL操作")]),s._v(" "),t("h3",{attrs:{id:"查询所有索引"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查询所有索引"}},[s._v("#")]),s._v(" 查询所有索引")]),s._v(" "),t("div",{staticClass:"language-json extra-class"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[s._v("GET _sql?format=txt\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"query"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('"\n show tables\n '),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('"\n'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n结果：\n#! this request accesses system indices"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(".kibana_task_manager_7."),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(".0_001"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" .security"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("-7")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" .kibana_7."),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(".0_001"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" .transform-internal"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("-006")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" but in a future major version"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" direct access to system indices will be prevented by default\n#! this request accesses system indices"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(".apm-agent-configuration"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" .apm-custom-link"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" .async-search"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" .kibana_7."),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(".0_001"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" .kibana_task_manager_7."),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(".0_001"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" .security"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("-7")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" .tasks"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" .transform-internal"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("-006")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" but in a future major version"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" direct access to system indices will be prevented by default\n                  name                   |     type      |     kind      \n-----------------------------------------+---------------+---------------\n.apm-agent-configuration                 |TABLE          |INDEX          \n.apm-custom-link                         |TABLE          |INDEX          \n.async-search                            |TABLE          |INDEX          \n.data-frame-internal"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("-3")]),s._v("                   |VIEW           |ALIAS          \n.kibana                                  |VIEW           |ALIAS          \n.kibana-event-log"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("-7.12")]),s._v("."),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("                 |VIEW           |ALIAS          \n.kibana-event-log"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("-7.12")]),s._v("."),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("-000001")]),s._v("          |TABLE          |INDEX          \n.kibana_7."),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12.0")]),s._v("                           |VIEW           |ALIAS          \n.kibana_7."),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(".0_001                       |TABLE          |INDEX          \n.kibana_task_manager                     |VIEW           |ALIAS          \n.kibana_task_manager_7."),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12.0")]),s._v("              |VIEW           |ALIAS          \n.kibana_task_manager_7."),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(".0_001          |TABLE          |INDEX          \n.security                                |VIEW           |ALIAS          \n.security"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("-7")]),s._v("                              |TABLE          |INDEX          \n.tasks                                   |TABLE          |INDEX          \n.transform-internal"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("-006")]),s._v("                  |TABLE          |INDEX          \nanimal                                   |TABLE          |INDEX          \nemployee                                 |TABLE          |INDEX          \ngmall                                    |TABLE          |INDEX          \nkibana_sample_data_ecommerce             |TABLE          |INDEX          \nmetrics-endpoint.metadata_current_default|TABLE          |INDEX          \nmy-sql-index                             |TABLE          |INDEX          \nmy_temp_2                                |TABLE          |INDEX          \nmy_temp_3                                |TABLE          |INDEX          \nshopping                                 |TABLE          |INDEX          \ntest_score                               |TABLE          |INDEX          \ntest_temp_2                              |TABLE          |INDEX          \n")])])]),t("h3",{attrs:{id:"查询指定索引"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查询指定索引"}},[s._v("#")]),s._v(" 查询指定索引")]),s._v(" "),t("div",{staticClass:"language-JSON extra-class"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[s._v("GET _sql?format=txt\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"query"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\"\n show tables like 'shop'\n "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('"\n'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n结果：\n     name      |     type      |     kind      \n---------------+---------------+---------------\n")])])]),t("h3",{attrs:{id:"模糊查询索引"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#模糊查询索引"}},[s._v("#")]),s._v(" 模糊查询索引")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("GET _sql?format"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("txt\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"query"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('"\n show tables like '),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%shop%'")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('"\n'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n结果：\n     name      "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("type")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("     kind      \n---------------+---------------+---------------\nshopping       "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("TABLE          "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("INDEX          \n")])])]),t("h3",{attrs:{id:"查看索引结构"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查看索引结构"}},[s._v("#")]),s._v(" 查看索引结构")]),s._v(" "),t("div",{staticClass:"language-json extra-class"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[s._v("GET _sql?format=txt\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"query"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('"\n describe shopping\n '),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('"\n'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n结果：\n     column     |     type      |    mapping    \n----------------+---------------+---------------\nabout           |VARCHAR        |text           \ncategory        |VARCHAR        |text           \ncategory.keyword|VARCHAR        |keyword        \nimages          |VARCHAR        |text           \nimages.keyword  |VARCHAR        |keyword        \nprice           |BIGINT         |long           \ntitle           |VARCHAR        |text           \ntitle.keyword   |VARCHAR        |keyword        \n")])])]),t("h3",{attrs:{id:"基础查询操作"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#基础查询操作"}},[s._v("#")]),s._v(" 基础查询操作")]),s._v(" "),t("div",{staticClass:"language-json extra-class"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[s._v("# 基本 SQL 格式\nSELECT select_expr "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" ..."),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" FROM table_name "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" WHERE condition "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" GROUP BY grouping_element "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" ..."),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" HAVING condition"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" ORDER BY expression "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" ASC | DESC "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" ..."),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" LIMIT "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" count "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" PIVOT ( aggregation_expr FOR column IN ( value "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" AS "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" alias "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" ..."),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" ) ) "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])])]),t("p",[t("strong",[s._v("where")])]),s._v(" "),t("div",{staticClass:"language-json extra-class"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[s._v("# 条件过滤\nPOST _sql?format=txt\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"query"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('" SELECT * FROM '),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"my-sql-index"')]),s._v(" where name = 'JAVA' "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('"\n'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n结果：\n    author     |     name      |  page_count   |      release_date      \n---------------+---------------+---------------+------------------------\nzhangsan       |JAVA           |"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("561")]),s._v("            |"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("-05")]),s._v("-01T00"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(".000Z\n")])])]),t("p",[t("strong",[s._v("group by")])]),s._v(" "),t("div",{staticClass:"language-json extra-class"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[s._v("# 按照日期进行分组\nGET _sql?format=txt\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"query"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('"\n SELECT release_date FROM '),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"my-sql-index"')]),s._v(" group by release_date\n "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('"\n'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n结果：\n      release_date      \n------------------------\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("-05")]),s._v("-01T00"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(".000Z\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("-05")]),s._v("-02T00"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(".000Z\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("-05")]),s._v("-03T00"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(".000Z\n")])])]),t("p",[t("strong",[s._v("having")])]),s._v(" "),t("div",{staticClass:"language-json extra-class"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[s._v("# 对分组后的数据进行过滤\nGET _sql?format=txt\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"query"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('"\n SELECT sum(page_count)'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" release_date as datacnt FROM "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"my-sql-index"')]),s._v(" group \nby release_date having sum(page_count) > "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('"\n'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n结果：\nsum(page_count)|    datacnt    \n---------------+---------------\n")])])]),t("p",[t("strong",[s._v("order by")])]),s._v(" "),t("div",{staticClass:"language-json extra-class"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[s._v("# 对页面数量进行排序（降序）\nGET _sql?format=txt\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"query"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('"\n select * from '),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"my-sql-index"')]),s._v(" order by page_count desc\n "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('"\n'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n结果：\n    author     |     name      |  page_count   |      release_date      \n---------------+---------------+---------------+------------------------\nwangwu         |SCALA          |"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("604")]),s._v("            |"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("-05")]),s._v("-03T00"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(".000Z\nzhangsan       |JAVA           |"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("561")]),s._v("            |"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("-05")]),s._v("-01T00"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(".000Z\nlisi           |BIGDATA        |"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("482")]),s._v("            |"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("-05")]),s._v("-02T00"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(".000Z\n")])])]),t("p",[t("strong",[s._v("limit")])]),s._v(" "),t("div",{staticClass:"language-JSON extra-class"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[s._v("# 限定查询数量\nGET _sql?format=txt\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"query"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('"\n select * from '),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"my-sql-index"')]),s._v(" limit "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('"\n'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n结果：\n    author     |     name      |  page_count   |      release_date      \n---------------+---------------+---------------+------------------------\nzhangsan       |JAVA           |"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("561")]),s._v("            |"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("-05")]),s._v("-01T00"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(".000Z\nlisi           |BIGDATA        |"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("482")]),s._v("            |"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("-05")]),s._v("-02T00"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(".000Z\nwangwu         |SCALA          |"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("604")]),s._v("            |"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("-05")]),s._v("-03T00"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(".000Z\n")])])]),t("p",[t("strong",[s._v("cursor")])]),s._v(" "),t("p",[s._v("游标（cursor）是系统为用户开设的一个数据缓冲区，存储 sql 语句的执行结果，每个游标区都有一个名字，用户可以用 sql 语句逐一从游标中获取记录，并赋给主变量，交由主语言进一步处理。就本质而言，游标实际上是一种能从包括多条数据记录的结果集中每次提取一条或多条记录的机制")]),s._v(" "),t("div",{staticClass:"language-json extra-class"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[s._v("# 查询数据\n# 因为查询结果较多，但是获取的数据较少，所以为了提高效果，会将数据存储到临时缓冲区中\n# 此处数据展示格式为 json\nPOST _sql?format=json\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"query"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('" SELECT * FROM '),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"my-sql-index"')]),s._v(" order by page_count desc "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('"'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"fetch_size"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n结果：\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"columns"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"name"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"author"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"type"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"text"')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"name"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"type"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"text"')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"name"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"page_count"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"type"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"long"')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"name"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"release_date"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"type"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"datetime"')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"rows"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"wangwu"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"SCALA"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("604")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2022-05-03T00:00:00.000Z"')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"zhangsan"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"JAVA"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("561")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2022-05-01T00:00:00.000Z"')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"cursor"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"48myAwFaAXN4RkdsdVkyeDFaR1ZmWTI5dWRHVjRkRjkxZFdsa0RYRjFaWEo1UVc1a1JtVjBZMmdCRm1rMVYwNTRORWxVVTBWVFZsOXlPV3hMZEdNMU1uY0FBQUFBQUFBOGhoWk5RM3BOVkRSTWRsSnhhVEZ5TW5OSE1uYzNhMnBu/////w8EAWYGYXV0aG9yAQR0ZXh0AAABZgRuYW1lAQR0ZXh0AAABZgpwYWdlX2NvdW50AQRsb25nAAABZgxyZWxlYXNlX2RhdGUBCGRhdGV0aW1lAAABDw=="')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),t("div",{staticClass:"language-JSON extra-class"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[s._v("# 此处游标 cursor 值需要根据读者执行的操作进行修改，请勿直接使用\nPOST /_sql?format=json\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"cursor"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(' \n"'),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("/LoA0RGTABEissKgkAYRh2QiAh8FZVcuExKaWisxEbHTUzO7wVH7TKSb19Gi87ig8N3UIaeox/\nIgdmjlQW0YLY7iICuhO9aIpHNJvWtLMXOKXGaqKUms0vPb8wXSSJCtyE7N3JP2ggfKCZRjHdxmq9\n/eFc8Zndi0wJoeGY0PJLOq7lZVWJrJXFaee8JQ0fFjA+q6h9IVzAqTUOF3vEW/rq48RIueT90Cum\ny78pvs3yABP6Ei+AK0Py7qm5huowPAAAA"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('//8DAA=="')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),t("div",{staticClass:"language-JSON extra-class"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[s._v("# 此处游标 cursor 值需要根据读者执行的操作进行修改，请勿直接使用\nPOST _sql/close\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"cursor"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(' \n"'),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("/LoA0RGTABEissKgkAYRh2QiAh8FZVcuExKaWisxEbHTUzO7wVH7TKSb19Gi87ig8N3UIaeox/\nIgdmjlQW0YLY7iICuhO9aIpHNJvWtLMXOKXGaqKUms0vPb8wXSSJCtyE7N3JP2ggfKCZRjHdxmq9\n/eFc8Zndi0wJoeGY0PJLOq7lZVWJrJXFaee8JQ0fFjA+q6h9IVzAqTUOF3vEW/rq48RIueT90Cum\ny78pvs3yABP6Ei+AK0Py7qm5huowPAAAA"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('//8DAA=="')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),t("p",[t("strong",[s._v("基础聚合查询")])]),s._v(" "),t("p",[s._v("在 ES 中使用 SQL 查询的聚合语法与在数据库中使用基本一致")]),s._v(" "),t("p",[s._v("Min、Max、Avg、Sum、Count(*)、Distinct")]),s._v(" "),t("div",{staticClass:"language-json extra-class"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[s._v("GET _sql?format=txt\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"query"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('"\n SELECT \n MIN(page_count) min'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n MAX(page_count) max"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n AVG(page_count) avg"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n SUM(page_count) sum"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n COUNT(*) count"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n COUNT(DISTINCT name) dictinct_count \n FROM "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"my-sql-index"')]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('"\n'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n结果：\n      min      |      max      |      avg      |      sum      |     count     |dictinct_count \n---------------+---------------+---------------+---------------+---------------+---------------\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("482.0")]),s._v("          |"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("604.0")]),s._v("          |"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("549.0")]),s._v("          |"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1647.0")]),s._v("         |"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("              |"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("              \n")])])]),t("h3",{attrs:{id:"支持的函数和运算"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#支持的函数和运算"}},[s._v("#")]),s._v(" 支持的函数和运算")]),s._v(" "),t("p",[t("strong",[s._v("比较运算符")])]),s._v(" "),t("div",{staticClass:"language-json extra-class"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[s._v("# Equality\nSELECT * FROM "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"my-sql-index"')]),s._v(" WHERE name = 'JAVA'\n# Null Safe Equality\nSELECT 'elastic' <=> "),t("span",{pre:!0,attrs:{class:"token null keyword"}},[s._v("null")]),s._v(" AS "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"equals"')]),s._v("\nSELECT "),t("span",{pre:!0,attrs:{class:"token null keyword"}},[s._v("null")]),s._v(" <=> "),t("span",{pre:!0,attrs:{class:"token null keyword"}},[s._v("null")]),s._v(" AS "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"equals"')]),s._v("\n# Inequality\nSELECT * FROM "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"my-sql-index"')]),s._v(" WHERE name <> 'JAVA'\nSELECT * FROM "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"my-sql-index"')]),s._v(" WHERE name != 'JAVA'\n# Comparison\nSELECT * FROM "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"my-sql-index"')]),s._v(" WHERE page_count > "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("500")]),s._v("\nSELECT * FROM "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"my-sql-index"')]),s._v(" WHERE page_count >= "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("500")]),s._v("\nSELECT * FROM "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"my-sql-index"')]),s._v(" WHERE page_count < "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("500")]),s._v("\nSELECT * FROM "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"my-sql-index"')]),s._v(" WHERE page_count <= "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("500")]),s._v("\n# BETWEEN\nSELECT * FROM "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"my-sql-index"')]),s._v(" WHERE page_count between "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v(" and "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("500")]),s._v("\n# Is Null / Is Not Null\nSELECT * FROM "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"my-sql-index"')]),s._v(" WHERE name is not "),t("span",{pre:!0,attrs:{class:"token null keyword"}},[s._v("null")]),s._v("\nSELECT * FROM "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"my-sql-index"')]),s._v(" WHERE name is "),t("span",{pre:!0,attrs:{class:"token null keyword"}},[s._v("null")]),s._v("\n# IN\nSELECT * FROM "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"my-sql-index"')]),s._v(" WHERE name in ('JAVA'"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" 'SCALA')\n")])])]),t("p",[t("strong",[s._v("逻辑运算符")])]),s._v(" "),t("div",{staticClass:"language-json extra-class"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[s._v("# AND\nSELECT * FROM "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"my-sql-index"')]),s._v(" WHERE name = 'JAVA' AND page_count > "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\n# OR\nSELECT * FROM "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"my-sql-index"')]),s._v(" WHERE name = 'JAVA' OR name = 'SCALA'\n# NOT\nSELECT * FROM "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"my-sql-index"')]),s._v(" WHERE NOT name = 'JAVA'\n")])])]),t("p",[t("strong",[s._v("数学运算符")])]),s._v(" "),t("div",{staticClass:"language-json extra-class"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[s._v("# 加减乘除\nselect "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" + "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" as x\nselect "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" - "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" as x\nselect - "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" as x\nselect "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" * "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" as x\nselect "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),s._v(" / "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" as x\nselect "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),s._v(" % "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(" as x\n")])])]),t("p",[t("strong",[s._v("类型转换")])]),s._v(" "),t("div",{staticClass:"language-json extra-class"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[s._v("# 类型转换\nSELECT '"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("123")]),s._v("'"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("long AS long\n")])])]),t("p",[t("strong",[s._v("模糊查询")])]),s._v(" "),t("div",{staticClass:"language-json extra-class"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[s._v("# LIKE 通配符\nSELECT * FROM "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"my-sql-index"')]),s._v(" WHERE name like 'JAVA%'\nSELECT * FROM "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"my-sql-index"')]),s._v(" WHERE name like 'JAVA_'\n# 如果需要匹配通配符本身"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("使用转义字符\nSELECT * FROM "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"my-sql-index"')]),s._v(" WHERE name like 'JAVA/%' ESCAPE '/'\n# RLIKE 不要误会，这里的 R 表示的不是方向，而是正则表示式 Regex\nSELECT * FROM "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"my-sql-index"')]),s._v(" WHERE name like 'JAV*A'\nSELECT * FROM "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"my-sql-index"')]),s._v(" WHERE name rlike 'JAV*A'\n# 尽管 LIKE在 Elasticsearch SQL 中搜索或过滤时是一个有效的选项，但全文搜索 MATCH 和 QUERY\n速度更快、功能更强大，并且是首选替代方案\n")])])]),t("p",[t("strong",[s._v("聚合分析函数")])]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# FIRST / FIRST_VALUE : FIRST(第一个字段，排序字段)")]),s._v("\nSELECT first"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("name, release_date"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" FROM "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"my-sql-index"')]),s._v("\nSELECT first_value"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("substring"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("name,2,1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")]),s._v(" FROM "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"my-sql-index"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# LAST / LAST_VALUE : LAST (第一个字段，排序字段)")]),s._v("\nSELECT last"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("name, release_date"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" FROM "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"my-sql-index"')]),s._v("\nSELECT last_value"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("substring"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("name,2,1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")]),s._v(" FROM "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"my-sql-index"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# KURTOSIS 量化字段的峰值分布")]),s._v("\nSELECT KURTOSIS"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("page_count"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" FROM "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"my-sql-index"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# MAD")]),s._v("\nSELECT MAD"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("page_count"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" FROM "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"my-sql-index"')]),s._v("\n")])])]),t("p",[t("strong",[s._v("分组函数")])]),s._v(" "),t("div",{staticClass:"language-json extra-class"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[s._v("# HISTOGRAM "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" 直方矩阵\nSELECT HISTOGRAM(page_count"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v(") as c， count(*) FROM "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"my-sql-index"')]),s._v(" group by \nc\n")])])]),t("p",[t("strong",[s._v("数学通用函数")])]),s._v(" "),t("div",{staticClass:"language-json extra-class"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[s._v("# ABS：求数字的绝对值\nselect ABS(page_count) from "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"myindex"')]),s._v(" limit "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n# CBRT：求数字的立方根，返回 double\nselect page_count v"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("CBRT(page_count) cbrt from "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"myindex"')]),s._v(" limit "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n# CEIL：返回大于或者等于指定表达式最小整数（double）\nselect page_count v"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("CEIL(page_count) from "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"myindex"')]),s._v(" limit "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n# CEILING：等同于 CEIL\nselect page_count v"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("CEILING(page_count) from "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"myindex"')]),s._v(" limit "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n# E：返回自然常数 e("),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.718281828459045")]),s._v(")\nselect page_count"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("E(page_count) from "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"myindex"')]),s._v(" limit "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n# ROUND：四舍五入精确到个位\nselect ROUND("),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("-3.14")]),s._v(")\n# FLOOR：向下取整\nselect FLOOR("),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.14")]),s._v(")\n# LOG：计算以 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" 为底的自然对数\nselect LOG("),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(")\n# LOG10：计算以 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" 为底的自然对数\nselect LOG10("),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v(")\n# SQRT：求一个非负实数的平方根\nselect SQRT("),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v(")\n# EXP：此函数返回 e(自然对数的底)的 X 次方的值\nselect EXP("),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(")\n")])])]),t("p",[t("strong",[s._v("三角函数")])]),s._v(" "),t("div",{staticClass:"language-json extra-class"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[s._v("# DEGREES：返回 X 从弧度转换为度值\nselect DEGREES(x)\n# RADIANS：返回 X 从度转换成弧度的值\nselect RADIANS(x)\n# SIN：返回 X 的正弦\nselect SIN(x)\n# COS：返回 X，X 值是以弧度给出的余弦值\nselect COS(角度)\n# TAN：返回参数 X，表示以弧度的切线值\nselect TAN(角度)\n# ASIN：返回 X 的反正弦，X 的值必须在"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("-1")]),s._v(" 至 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" 范围内，返回 NULL\nselect ASIN(x)\n# ACOS：返回 X 的反正弦，X 值必须"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("-1")]),s._v(" 到 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" 之间范围否则将返回 NULL\nselect ACOS(x)\n# ATAN：返回 X 的反正切\nselect ATAN(x)\n# SINH：返回 X 的双曲正弦值\nselect SINH(x)\n# COSH：返回 X 的双曲余弦值\nselect COSH(x)\n")])])]),t("p",[t("strong",[s._v("日期时间函数")])]),s._v(" "),t("div",{staticClass:"language-json extra-class"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[s._v("# YEAR：\nSELECT YEAR(CAST('"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("-05")]),s._v("-01T00"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("00Z' AS TIMESTAMP)) AS year\n# MONTH_OF_YEAR() or MONTH()：\nSELECT MONTH(CAST('"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("-05")]),s._v("-01T00"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("00Z' AS TIMESTAMP)) AS month\n# WEEK_OF_YEAR() or WEEK()：\nSELECT WEEK(CAST('"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("-05")]),s._v("-01T00"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("00Z' AS TIMESTAMP)) AS week\n# DAY_OF_YEAR() or DOY() ，效果等同于 EXTRACT(<datetime_function> FROM \n<expression>)：\nSELECT DOY(CAST('"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("-05")]),s._v("-01T00"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("00Z' AS TIMESTAMP)) AS day\n# DAY_OF_MONTH()"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" DOM()"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" or DAY()：\nSELECT DAY(CAST('"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("-05")]),s._v("-01T00"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("00Z' AS TIMESTAMP)) AS day\n# DAY_OF_WEEK() or DOW()：\nSELECT DOW(CAST('"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("-05")]),s._v("-01T00"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("00Z' AS TIMESTAMP)) AS day\n# HOUR_OF_DAY() or HOUR()：\nSELECT HOUR(CAST('"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("-05")]),s._v("-01T00"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("00Z' AS TIMESTAMP)) AS hour\n# MINUTE_OF_DAY()：\nSELECT MINUTE_OF_DAY(CAST('"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("-05")]),s._v("-01T00"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("00Z' AS TIMESTAMP)) AS minute\n# MINUTE_OF_HOUR() or MINUTE()：\nSELECT MINUTE(CAST('"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("-05")]),s._v("-01T00"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("00Z' AS TIMESTAMP)) AS minute\n# SECOND_OF_MINUTE() or SECOND()：\nSELECT SECOND(CAST('"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("-05")]),s._v("-01T00"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("00Z' AS TIMESTAMP)) AS second\n")])])]),t("p",[t("strong",[s._v("全文检索函数")])]),s._v(" "),t("div",{staticClass:"language-json extra-class"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[s._v("# MATCH：MATCH(匹配字段，规则"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" 配置参数(可选))\nSELECT * FROM "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"my-sql-index"')]),s._v(" where MATCH(name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" 'JAVA')\nSELECT * FROM "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"my-sql-index"')]),s._v(" where MATCH(name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" 'java')\n# MATCH：MATCH(('匹配字段^权重 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("匹配字段^权重 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("'，规则"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" 配置参数(可选))\nSELECT * FROM "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"my-sql-index"')]),s._v(" where MATCH('author^"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("name^"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("'"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" 'java')\n# QUERY\nSELECT * FROM "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"my-sql-index"')]),s._v(" where QUERY('name"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("Java')\n# SCORE "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" 评分\nSELECT *"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" score() FROM "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"my-sql-index"')]),s._v(" where QUERY('name"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("Java')\n")])])]),t("p",[t("strong",[s._v("字符串检索函数")])]),s._v(" "),t("div",{staticClass:"language-json extra-class"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[s._v("# ASCII "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" 字符串转成 ASC 码\nSELECT ASCII('Elastic')\n# BIT_LENGTH ： 位长度\nSELECT BIT_LENGTH('Elastic')\nSELECT BIT_LENGTH('中国')\n# CHAR ：转换字符\nSELECT CHAR("),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("69")]),s._v(")\n# CHAR_LENGTH ：字符长度\nSELECT CHAR_LENGTH('Elastic')\n# CONCAT"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("合并\nSELECT CONCAT('Elastic'"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" 'search')\n# INSERT "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" INSERT(字符串，起始位置，长度，插入的内容)\nSELECT INSERT('Elastic'"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" 'search')\nSELECT INSERT('Elastic'"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" 'search')\n# LCASE ：转换小写\nSELECT LCASE('Elastic')\n# LEFT "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" 获取左边最多 N 个字符\nSELECT LEFT('Elastic'"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(")\n# LENGTH\nSELECT length('Elastic')\nSELECT length('中国')\n# LOCATE "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" LOCATE(表达式，字符串，起始位置)，获取满足条件的位置\nSELECT LOCATE('a'"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" 'Elasticsearch')\nSELECT LOCATE('a'"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" 'Elasticsearch'"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(")\n# LTRIM ：去除左边的空格\nSELECT LTRIM(' Elastic')\n# OCTET_LENGTH "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" 字节长度\nSELECT OCTET_LENGTH('Elastic')\nSELECT OCTET_LENGTH('中国')\n# POSITION ：获取指定字符串的位置\nSELECT POSITION('Elastic'"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" 'Elasticsearch')\n# REPEAT ：将字符串重复指定次数\nSELECT REPEAT('Elastic'"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(")\n# REPLACE ：替换数据\nSELECT REPLACE('Elastic'"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("'El'"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("'Fant')\n# RIGHT ：从右边获取指定数量的数据\nSELECT RIGHT('Elastic'"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(")\n# RTRIM ：去除右边的空格\nSELECT RTRIM('Elastic ')\n# SPACE "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" 生成指定数量的空格\nSELECT concat(SPACE("),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(")"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("'abc')\n# STARTS_WITH "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" 判断是否以指定字符串开头\nSELECT STARTS_WITH('Elasticsearch'"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" 'Elastic')\n# SUBSTRING ： 截取字符串，必须传递三个参数\nSELECT SUBSTRING('Elasticsearch'"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(")\n# TRIM ：去掉首尾空格\nSELECT TRIM(' Elastic ') AS trimmed\n# UCASE "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" 转换大写\nSELECT UCASE('Elastic')\n")])])]),t("p",[t("strong",[s._v("条件分支函数")])]),s._v(" "),t("div",{staticClass:"language-json extra-class"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[s._v("# 多重分支判断\nSELECT CASE "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n WHEN "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" THEN 'elastic'\n WHEN "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" THEN 'search'\n WHEN "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" THEN 'elasticsearch'\n ELSE 'default'\n END AS "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"case"')]),s._v("\nSELECT CASE WHEN "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" > "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" THEN 'elastic'\n WHEN "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" > "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" THEN 'search'\n ELSE 'default'\n END AS "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"case"')]),s._v("\n# IFNULL\nSELECT IFNULL('elastic'"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token null keyword"}},[s._v("null")]),s._v(") AS "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ifnull"')]),s._v("\nSELECT IFNULL("),t("span",{pre:!0,attrs:{class:"token null keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" 'search') AS "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ifnull"')]),s._v("\n# IIF\nSELECT IIF("),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" < "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" 'TRUE'"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" 'FALSE') AS result1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" IIF("),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" > "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" 'TRUE'"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" 'FALSE') AS \nresult2\n# ISNULL\nSELECT ISNULL('elastic'"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token null keyword"}},[s._v("null")]),s._v(") AS "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"isnull"')]),s._v("\nSELECT ISNULL("),t("span",{pre:!0,attrs:{class:"token null keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" 'search') AS "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"isnull"')]),s._v("\n# LEAST"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("获取除 "),t("span",{pre:!0,attrs:{class:"token null keyword"}},[s._v("null")]),s._v(" 外的最小值\nSELECT LEAST("),t("span",{pre:!0,attrs:{class:"token null keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(") AS "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"least"')]),s._v("\nSELECT LEAST("),t("span",{pre:!0,attrs:{class:"token null keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token null keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token null keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token null keyword"}},[s._v("null")]),s._v(") AS "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"least"')]),s._v("\n# NULLIF "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" 如果两个字符串不相同，则返回第一个字符串，如果相同，返回 "),t("span",{pre:!0,attrs:{class:"token null keyword"}},[s._v("null")]),s._v("\nSELECT NULLIF('elastic'"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" 'search') AS "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nullif"')]),s._v("\nSELECT NULLIF('elastic'"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" 'elastic') AS "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nullif"')]),s._v("\n# NVL "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" 返回第一个不是 "),t("span",{pre:!0,attrs:{class:"token null keyword"}},[s._v("null")]),s._v(" 的字符串，如果都是 "),t("span",{pre:!0,attrs:{class:"token null keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("那么返回 Null\nSELECT NVL('elastic'"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token null keyword"}},[s._v("null")]),s._v(") AS "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nvl"')]),s._v("\nSELECT NVL("),t("span",{pre:!0,attrs:{class:"token null keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token null keyword"}},[s._v("null")]),s._v(") AS "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nvl"')]),s._v("\n")])])]),t("p",[t("strong",[s._v("系统函数")])]),s._v(" "),t("div",{staticClass:"language-json extra-class"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[s._v("# ES 集群\nSELECT DATABASE()\n# 用户\nSELECT USER()\n")])])])])}),[],!1,null,null,null);t.default=e.exports}}]);