(window.webpackJsonp=window.webpackJsonp||[]).push([[91],{555:function(t,a,s){"use strict";s.r(a);var e=s(14),r=Object(e.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h2",{attrs:{id:"privileged-true"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#privileged-true"}},[t._v("#")]),t._v(" --privileged=true")]),t._v(" "),a("blockquote",[a("p",[t._v("如果是CentOS7安全模块会比之前系统版本加强，不安全的会先禁止，所以目录挂载的情况被默认为不安全的行为，在SELinux里面挂载目录被禁止掉了额，如果要开启，我们一般使用--privileged=true命令，扩大容器的权限解决挂载目录没有权限的问题，也即使用该参数，container内的root拥有真正的root权限，否则，container内的root只是外部的一个普通用户权限。")])]),t._v(" "),a("p",[t._v("Docker挂载主机目录访问如果出现cannot open directory .: Permission denied\n解决办法：在挂载目录后多加一个--privileged=true参数即可")]),t._v(" "),a("h2",{attrs:{id:"简介"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#简介"}},[t._v("#")]),t._v(" 简介")]),t._v(" "),a("p",[t._v("用于docker容器数据持久化，可以将docker容器中数据保存进宿主机的磁盘。")]),t._v(" "),a("h2",{attrs:{id:"添加数据卷"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#添加数据卷"}},[t._v("#")]),t._v(" 添加数据卷")]),t._v(" "),a("h3",{attrs:{id:"直接命令添加"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#直接命令添加"}},[t._v("#")]),t._v(" 直接命令添加")]),t._v(" "),a("p",[a("strong",[t._v("运行一个带容器卷存储功能的容器实例")])]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-it")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--privileged")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("true  "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-v")]),t._v(" 宿主机绝对路径:容器内目录 镜像名\n")])])]),a("p",[a("strong",[t._v("查看数据卷是否挂载成功")])]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" inspect 3c9ff35cea6a\n")])])]),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Mounts"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Type"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"bind"')]),t._v(",\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Source"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/data/centosShare"')]),t._v(",\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Destination"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/data"')]),t._v(",\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Mode"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v(",\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"RW"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" true,\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Propagation"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"rprivate"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(",\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n")])])]),a("p",[a("strong",[t._v("测试数据共享")])]),t._v(" "),a("p",[t._v("在宿主机/data/centosShare下创建文件，容器中立马可以查看")]),t._v(" "),a("p",[t._v("在容器/data下创建文件，宿主机中立马可以查看")]),t._v(" "),a("h3",{attrs:{id:"读写规则添加"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#读写规则添加"}},[t._v("#")]),t._v(" 读写规则添加")]),t._v(" "),a("p",[a("strong",[t._v("读写权限（默认）")])]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-it")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--privileged")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("true "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-v")]),t._v(" /宿主机绝对路径目录:/容器内目录:rw      镜像名\n")])])]),a("p",[a("strong",[t._v("只读权限")])]),t._v(" "),a("p",[t._v("容器内部被限制为只能读取不能写入")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-it")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--privileged")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("true "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-v")]),t._v(" /宿主机绝对路径目录:/容器内目录:ro      镜像名\n")])])]),a("h3",{attrs:{id:"数据卷继承和共享"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#数据卷继承和共享"}},[t._v("#")]),t._v(" 数据卷继承和共享")]),t._v(" "),a("ol",[a("li",[t._v("容器1完成与宿主机的映射")])]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@localhost centosShare"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# docker run -it --privileged=true -v /data/centosShare:/data:ro centos /bin/bash")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@42e83fe848a2 /"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cd /data/")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@42e83fe848a2 data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ls")]),t._v("\ntestShare.txt\n")])])]),a("ol",{attrs:{start:"2"}},[a("li",[t._v("容器2继承容器1的数据卷规则")])]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@localhost centosShare"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# docker run -it --privileged=true --volumes-from u1 --name u2 centos")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@22b0bf176b47 /"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cd /data/")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@22b0bf176b47 data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ls")]),t._v("\ntestShare.txt\n")])])])])}),[],!1,null,null,null);a.default=r.exports}}]);