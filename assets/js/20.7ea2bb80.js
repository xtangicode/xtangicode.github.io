(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{276:function(t,a,s){t.exports=s.p+"assets/img/lmt_01.2b05b09f.jpg"},277:function(t,a,s){t.exports=s.p+"assets/img/lmt_02.7819814b.jpg"},432:function(t,a,s){"use strict";s.r(a);var n=s(14),e=Object(n.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h2",{attrs:{id:"协议介绍"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#协议介绍"}},[t._v("#")]),t._v(" 协议介绍")]),t._v(" "),a("p",[a("strong",[t._v("RTSP")]),t._v("\nRTSP （Real-Time Stream Protocol）由Real Networks 和 Netscape共同提出的，基于文本的多媒体播放控制协议。RTSP定义流格式，流数据经由RTP传输；RTSP实时效果非常好，适合视频聊天，视频监控等方向。一般摄像头都是RTSP格式的。h5原生不支持这种格式。\n"),a("strong",[t._v("优点")]),t._v("，可以控制到视频帧，因此可以承载实时性很高的应用。这个优点是相对于HTTP方式的最大优点。复杂度主要集中在服务器端，可以进行倍速播放功能，其他视频协议都无法支持。 网络延时低，一般在0.5S以内；\n"),a("strong",[t._v("缺点")]),t._v("，就是服务器端的复杂度也比较高，实现起来也比较复杂。ios端不支持该协议，对移动端支持较弱；除了 Firefox 浏览器可以直接播放 RTSP 流之外,几乎没有其他浏览器可以直接播放 RTSP 流。RTSP协议，此协议和RTMP效果差不多，在技术上只是区别于传输数据上占用多少通道、传输格式流不太一样而已，RTSP其实也可以用于直播。但依然是因为市场环境，RTSP目前主要应用在安防监控上，和RTMP一样，早已形成了自己的盈利链")]),t._v(" "),a("p",[a("strong",[t._v("RTMP")]),t._v("\nRTMP（Real Time Message Protocol） 有 Adobe 公司提出，用来解决多媒体数据传输流的多路复用（Multiplexing）和分包（packetizing）的问题，优势在于低延迟，稳定性高，支持所有摄像头格式，RTMP协议是采用实时的流式传输，所以不会缓存文件到客户端，这种特性说明用户想下载RTMP协议下的视频是比较难的，视频流可以随便拖动，既可以从任意时间点向服务器发送请求进行播放，并不需要视频有关键帧。相比而言，HTTP协议下视频需要有关键帧才可以随意拖动，rtmp协议只支持flashplayer 就是只能在PC端（或安卓环境中安装了flashplayer组件，这种环境比较少）安装了flashplayer的情况下使用，浏览器加载 flash插件就可以直接播放,但是flash已经日落西山了。因此，目前 RTMP 主要用于提取 stream。也就是，当设置解编码器将视频发送到托管平台时，视频将使用 RTMP 协议发送到 CDN，随后使用另一种协议（通常是HLS）传递给播放器")]),t._v(" "),a("p",[a("strong",[t._v("HTTP-FLV")]),t._v(" 即将流媒体数据封装成 FLV 格式，然后通过 HTTP 协议传输给客户端 HTTP协议中有个约定：content-length字段，http的body部分的长度服务器回复http请求的时候如果有这个字段，客户端就接收这个长度的数据然后就认为数据传输完成了，如果服务器回复http请求中没有这个字段，客户端就一直接收数据，直到服务器跟客户端的socket连接断开。http-flv直播就是利用第二个原理，服务器回复客户端请求的时候不加content-length字段，在回复了http内容之后，紧接着发送flv数据，客户端就一直接收数据了")]),t._v(" "),a("p",[a("strong",[t._v("HLS")]),t._v("\n当使用http协议的时候视频格式需要是m3u8或HTTP-FLV协议视频流。HLS 协议由三部分组成：HTTP、M3U8、TS。这三部分中，HTTP 是传输协议，M3U8 是索引文件，TS 是音视频的媒体信息m3u8是有延迟的。并不能实时，实时传输方面不如rtmp协议。因为m3u8的直播原理是将直播源不停的压缩成指定时长的ts文件（比如9秒，10秒一个ts文件）并同时实时更新m3u8文件里的列表以达到直播的效果。这样就会有一个至少9,10秒的时间延迟。如果压缩的过小，可能导致客户端网络原因致视频变卡。")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th"),t._v(" "),a("th",[t._v("RTMP/RTSP")]),t._v(" "),a("th",[t._v("HTTP-FLV")]),t._v(" "),a("th",[t._v("HLS")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("传输协议")]),t._v(" "),a("td",[t._v("TCP")]),t._v(" "),a("td",[t._v("HTTP")]),t._v(" "),a("td",[t._v("HTTP")])]),t._v(" "),a("tr",[a("td",[t._v("视频封装格式")]),t._v(" "),a("td",[t._v("flv")]),t._v(" "),a("td",[t._v("flv")]),t._v(" "),a("td",[t._v("ts")])]),t._v(" "),a("tr",[a("td",[t._v("延时")]),t._v(" "),a("td",[t._v("1-3秒")]),t._v(" "),a("td",[t._v("1-3秒")]),t._v(" "),a("td",[t._v("5-20秒")])]),t._v(" "),a("tr",[a("td",[t._v("Web支持")]),t._v(" "),a("td",[t._v("H5 不能直接播放")]),t._v(" "),a("td",[t._v("H5 不能直接播放")]),t._v(" "),a("td",[t._v("支持H5")])]),t._v(" "),a("tr",[a("td",[t._v("CPU")]),t._v(" "),a("td",[t._v("11%")]),t._v(" "),a("td",[t._v("4.4%")]),t._v(" "),a("td",[t._v("3%")])]),t._v(" "),a("tr",[a("td",[t._v("数据")]),t._v(" "),a("td",[t._v("连续流")]),t._v(" "),a("td",[t._v("连续流")]),t._v(" "),a("td",[t._v("切片文件")])]),t._v(" "),a("tr",[a("td",[t._v("优点")]),t._v(" "),a("td",[t._v("基于TCP长连接，不需要多次建连，延时低，通常只有1~3s；技术成熟，配套完善。")]),t._v(" "),a("td",[t._v("flv.js在获取到FLV格式的音视频数据后将 FLV 文件流转码复用成 ISO BMFF（MP4 碎片）片段，再通过Media Source Extensions API 传递给原生HTML5 Video标签进行播放。低延时，整体效果与RTMP非常接近；相较于RTMP协议，能有效避免防火墙和代理的影响。")]),t._v(" "),a("td",[t._v("基于HTTP协议，所以接入CDN较为容易，很少被防火墙拦下，且自带多码率自适应；作为苹果提出的协议，在macOS/iOS下有极大优势，Android中也提供了对应的支持；可以说此项协议用在移动设备上是再合适不过了")])]),t._v(" "),a("tr",[a("td",[t._v("缺点")]),t._v(" "),a("td",[t._v("在PC浏览器中只能通过Flash使用，且无法在移动浏览器使用；鉴于Flash即将退出舞台，所以在网页播放端基本不会以RTMP做拉流。")]),t._v(" "),a("td",[t._v("把音视频数据封装成FLV，然后通过HTTP连接传输，与RTMP相比只是传输协议变了。对于网页播放端，本来还是需要Flash才能播放，但「flv.js」的出现又弥补了这个缺陷它的传输特性会让流媒体资源缓存在本地客户端，也就是说保密性不怎么样；直到目前仍然不兼容iOS的浏览器")]),t._v(" "),a("td",[t._v("延时较大，通常不低于10s 。大量的TS片文件，会造成服务器存储和请求的压力")])]),t._v(" "),a("tr",[a("td",[t._v("推拉流")]),t._v(" "),a("td",[t._v("推拉流")]),t._v(" "),a("td",[t._v("拉流")]),t._v(" "),a("td",[t._v("拉流")])])])]),t._v(" "),a("h2",{attrs:{id:"ffmpeg介绍"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ffmpeg介绍"}},[t._v("#")]),t._v(" FFmpeg介绍")]),t._v(" "),a("h2",{attrs:{id:"vlc播放器介绍"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#vlc播放器介绍"}},[t._v("#")]),t._v(" VLC播放器介绍")]),t._v(" "),a("h2",{attrs:{id:"直播"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#直播"}},[t._v("#")]),t._v(" 直播")]),t._v(" "),a("h3",{attrs:{id:"推流实现"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#推流实现"}},[t._v("#")]),t._v(" 推流实现")]),t._v(" "),a("h4",{attrs:{id:"媒体服务器搭建"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#媒体服务器搭建"}},[t._v("#")]),t._v(" 媒体服务器搭建")]),t._v(" "),a("p",[t._v("方案一：Nginx添加模块nginx-rtmp-module\n方案二：Nginx添加模块nginx-http-flv-module，安装教程参考：Nginx安装的添加nginx-http-flv-module模块教程\nnginx-http-flv-module是基于nginx-rtmp-module 的流媒体服务器。它具备了所有nginx-rtmp-module的功能，并且新增多种新功能，功能对比如下")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("Features")]),t._v(" "),a("th",[t._v("nginx-http-flv-module")]),t._v(" "),a("th",[t._v("nginx-rtmp-module")]),t._v(" "),a("th")])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("HTTP-FLV (播放)")]),t._v(" "),a("td",[t._v("支持")]),t._v(" "),a("td",[t._v("不支持")]),t._v(" "),a("td",[t._v("支持 HTTPS-FLV 和 chunked 回复")])]),t._v(" "),a("tr",[a("td",[t._v("GOP 缓存")]),t._v(" "),a("td",[t._v("支持")]),t._v(" "),a("td",[t._v("不支持")]),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[t._v("虚拟主机")]),t._v(" "),a("td",[t._v("支持")]),t._v(" "),a("td",[t._v("不支持")]),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[t._v("省略 listen 配置")]),t._v(" "),a("td",[t._v("支持")]),t._v(" "),a("td",[t._v("See remarks")]),t._v(" "),a("td",[t._v("There MUST be at least one listen directive")])]),t._v(" "),a("tr",[a("td",[t._v("纯音频支持")]),t._v(" "),a("td",[t._v("支持")]),t._v(" "),a("td",[t._v("See remarks")]),t._v(" "),a("td",[t._v("Won't work if wait_video or wait_key is on")])]),t._v(" "),a("tr",[a("td",[t._v("Single-track support for HLS")]),t._v(" "),a("td",[t._v("支持")]),t._v(" "),a("td",[t._v("不支持")]),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[t._v("reuseport support")]),t._v(" "),a("td",[t._v("支持")]),t._v(" "),a("td",[t._v("不支持")]),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[t._v("Timer for access log")]),t._v(" "),a("td",[t._v("支持")]),t._v(" "),a("td",[t._v("不支持")]),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[t._v("JSON style statistics")]),t._v(" "),a("td",[t._v("支持")]),t._v(" "),a("td",[t._v("不支持")]),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[t._v("Statistics for recordings")]),t._v(" "),a("td",[t._v("支持")]),t._v(" "),a("td",[t._v("不支持")]),t._v(" "),a("td")])])]),t._v(" "),a("p",[a("strong",[t._v("配置RTMP推流和HTTP-FLV拉流方式")])]),t._v(" "),a("p",[t._v("配置nginx.conf")]),t._v(" "),a("div",{staticClass:"language-properties extra-class"},[a("pre",{pre:!0,attrs:{class:"language-properties"}},[a("code",[t._v("......\n......\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("rtmp")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("{")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("    server")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("{")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("        listen")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("20935;")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("        chunk_size")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("4000;")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("         # rtmp协议方式")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("        application")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("liveRtmp {")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("            live")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("on;")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("            gop_cache")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("on;")]),t._v("\n        }\n    }\n}\n\nhttp{\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v(" \tinclude")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("      /etc/nginx/mime.types;")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("    default_type")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v(" application/octet-stream;")]),t._v("\n    ......\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("    server")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("{")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("        listen")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("      80;")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("        server_name")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v(" localhost;")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("        #access_log  /var/log/nginx/host.access.log  main;")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("        location")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("/ {")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("            root")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("  /usr/share/nginx/html;")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("            index")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v(" index.html index.htm;")]),t._v("\n        }\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("        location")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("/flvTest {")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("            flv_live")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("on; #拉取HTTP-FLV的配置，打开HTTP播放FLV直播流功能")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("            chunked_transfer_encoding")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("on; #支持’Transfer-Encoding: chunked’方式回复    ")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("            add_header")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("'Access-Control-Allow-Origin' '*'; #添加额外的HTTP头    ")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("            add_header")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("'Access-Control-Allow-Credentials' 'true'; #添加额外的HTTP头    ")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("        }")]),t._v(" \n     ......\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("    }")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v(" ")]),t._v("\n}\n   \n")])])]),a("p",[a("strong",[t._v("配置RTMP推流和HLS拉流方式")])]),t._v(" "),a("p",[t._v("原理：")]),t._v(" "),a("ol",[a("li",[t._v("推流段RTMP推送")]),t._v(" "),a("li",[t._v("媒体服务器，对flv文件切片输出ts视频文件和m3u8索引文件")]),t._v(" "),a("li",[t._v("hls通过m3u8拉取ts文件播放")])]),t._v(" "),a("p",[t._v("弊端：延迟过大，原因是切片及等推流数据")]),t._v(" "),a("p",[t._v("优化：缩短ts间隔和个数，但还是比不过RTMP方式和HTTP-FLV方式。")]),t._v(" "),a("p",[t._v("配置nginx.conf")]),t._v(" "),a("div",{staticClass:"language-properties extra-class"},[a("pre",{pre:!0,attrs:{class:"language-properties"}},[a("code",[t._v("......\n......\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 推流时会发布到多个子进程")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# rtmp_auto_push on;")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# rtmp_auto_push_reconnect 1s;")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("rtmp")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("{")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("    server")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("{")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("        listen")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("20935;")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("        chunk_size")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("4000;")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("        # hls协议方式")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("        application")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("liveHls {")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("           live")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("on;")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("           #HLS协议进行m3u8实时直播.如果是http-flv方式不需要配置下面的")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("           #wait_key on;#保护TS切片")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("           hls")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("on;  #实时回访")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("           #hls_nested on;#每个流都自动创建一个文件夹")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("           hls_path")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("/opt/videoTmp; #媒体块ts的位置")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("           #hls_fragment 5s; #每个ts文件为5s的样子")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("           #hls_playlist_length 30s;  #保存m3u8列表长度时间，默认是30秒，可考虑三小时10800秒")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("           #hls_cleanup on;#是否删除列表中已经没有的媒体块TS文件，默认是开启")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("           #hls_continuous on;#连续模式")]),t._v("\n\n        }\n    }\n}\n\nhttp{\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v(" \tinclude")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("      /etc/nginx/mime.types;")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("    default_type")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v(" application/octet-stream;")]),t._v("\n    ......\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("    server")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("{")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("        listen")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("      80;")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("        server_name")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v(" localhost;")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("        #access_log  /var/log/nginx/host.access.log  main;")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("        location")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("/ {")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("            root")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("  /usr/share/nginx/html;")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("            index")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v(" index.html index.htm;")]),t._v("\n        }\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("         # 拉m3u8的配置")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("         location")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("/m3u8Test {")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("            types")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("{")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("                  application/vnd.apple.mpegurl")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("m3u8;")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("                  video/mp2t")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("ts;")]),t._v("\n            }\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("        \talias")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("/opt/videoTmp;")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("        \texpires")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("-1;")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("        \tadd_header")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("'Cache-Control' 'no-cache';")]),t._v("\n   \t\t }\n\n     ......\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("    }")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v(" ")]),t._v("\n}\n   \n")])])]),a("h4",{attrs:{id:"使用工具推流"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用工具推流"}},[t._v("#")]),t._v(" 使用工具推流")]),t._v(" "),a("p",[t._v("方案一：OBS推流\n方案二：FFmpeg推流，将视频流推送到nginx上，可以安装在windows或者linux。安装在Linux教程参考：FFmpeg安装。")]),t._v(" "),a("ol",[a("li",[t._v("将视频文件"),a("code",[t._v("2.mp4")]),t._v("放到"),a("code",[t._v("/opt/")]),t._v("下，执行如下命令，将视频流通FFmpeg推送到nginx。")])]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("ffmpeg  "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-re")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-i")]),t._v(" /opt/2.mp4 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-c")]),t._v(" copy "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" flv rtmp://127.0.0.1:20935/liveRtmp/room1\n")])])]),a("ol",{attrs:{start:"2"}},[a("li",[t._v("如果图中参数一直改变表示正在推流\n"),a("img",{attrs:{src:s(276),alt:""}})])]),t._v(" "),a("h3",{attrs:{id:"拉流实现"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#拉流实现"}},[t._v("#")]),t._v(" 拉流实现")]),t._v(" "),a("p",[t._v("前端一般可以播放媒体采用flv视频流或者读取m3u8中ts文件播放。")]),t._v(" "),a("h4",{attrs:{id:"拉流地址"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#拉流地址"}},[t._v("#")]),t._v(" 拉流地址")]),t._v(" "),a("p",[a("strong",[t._v("推流方式：媒体文件->RTMP服务器->HTTP-FLV拉流")])]),t._v(" "),a("p",[t._v("ffmpeg推流命令："),a("code",[t._v("ffmpeg -re -i /opt/2.mp4 -c copy -f flv rtmp://127.0.0.1:20935/liveRtmp/room1")]),t._v("\nrmtp拉流地址：rtmp://127.0.0.1:20935/liveRtmp/room1，可以采用VLC播放器播放\nhttp-flv拉流地址：http://192.168.133.128/flvTest?port=20935&app=liveRtmp&stream=room1 ，可以采用flv.js或者VLC播放器播放。")]),t._v(" "),a("p",[a("strong",[t._v("推流方式：媒体文件->RTMP服务器->HLS拉流")])]),t._v(" "),a("p",[t._v("ffmpeg推流命令："),a("code",[t._v("ffmpeg -re -i /opt/2.mp4 -c copy -f flv rtmp://127.0.0.1:20935/liveHls/room2")]),t._v("\nrmtp拉流地址：rtmp://192.168.133.128:20935/liveHls/room2，可以采用VLC播放器播放\nhls-m3u8拉流地址：  http://192.168.133.128/m3u8Test/room2.m3u8  m3u8文件在/opt/videoTmp下，可以使用VLC播放器播放。")]),t._v(" "),a("p",[a("strong",[t._v("VLC播放")])]),t._v(" "),a("p",[t._v("播放步骤：媒体->打开网络串流->添加地址(支持各种拉流地址)->下拉选播放")]),t._v(" "),a("p",[a("strong",[t._v("M3U8文件")])]),t._v(" "),a("p",[t._v("读取m3u8文件配置，将ts文件拼接。")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@txSugar videoTmp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ls")]),t._v("\nroom2-0.ts  room2-1.ts  room2.m3u8\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@txSugar videoTmp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cat room2.m3u8 ")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#EXTM3U")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#EXT-X-VERSION:3")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#EXT-X-MEDIA-SEQUENCE:0     #当前索引")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#EXT-X-TARGETDURATION:8    \t")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#EXT-X-DISCONTINUITY")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#EXTINF:8.424,")]),t._v("\nroom2-0.ts\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#EXTINF:7.405,")]),t._v("\nroom2-1.ts\n")])])]),a("h4",{attrs:{id:"前端拉流"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#前端拉流"}},[t._v("#")]),t._v(" 前端拉流？")]),t._v(" "),a("p",[a("strong",[t._v("方案一：")])]),t._v(" "),a("p",[t._v("Video.js 是一个通用的在网页上嵌入视频播放器的 JS 库，Video.js 自动检测浏览器对 HTML5 的支持情况，如果不支持 HTML5 则自动使用 Flash 播放器。Edge、谷歌浏览器中网站默认是禁用flash的，手动设置为允许flash即可")]),t._v(" "),a("p",[t._v("优点：")]),t._v(" "),a("p",[t._v("1.它是开源免费的，你可以在github很容易的获取它的最新代码。\n2.使用它非常的容易，只要花几秒钟就可以架起一个视频播放页面。\n3.它几乎兼容所有的浏览器，并且优先使用html5，在不支持的浏览器中，会自动使用flash进行播放。\n4.界面可以定制，纯javascript和css打造。说明文档也非常的详细。")]),t._v(" "),a("p",[t._v("缺点：")]),t._v(" "),a("p",[t._v("videojs针对部分摄像机（比如：海康）不是很友好，作者大大也很久没有维护的原因，部分rtsp、rtmp流的视频直播是无法找到媒体的兼容源")]),t._v(" "),a("p",[a("strong",[t._v("方案二：")])]),t._v(" "),a("p",[t._v("利用B站开源的flv.js，通过将FLV文件流转换为ISO BMFF（Fragmented MP4）段，然后通过Media Source Extensions API 将mp4段提供给HTML5 元素。flv.js是支持在 HTML5 视频中播放 FLV 格式视频的 JavaScript 库。")]),t._v(" "),a("div",{staticClass:"language-html extra-class"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[a("span",{pre:!0,attrs:{class:"token doctype"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<!")]),a("span",{pre:!0,attrs:{class:"token doctype-tag"}},[t._v("doctype")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token name"}},[t._v("html")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("html")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("lang")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("zh"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("head")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("meta")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("http-equiv")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("pragma"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("content")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("no-cache"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("meta")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("http-equiv")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("cache-control"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("content")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("no-cache"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("meta")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("http-equiv")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("expires"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("content")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("meta")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("viewport"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("content")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("width=device-width, initial-scale=1, minimum-scale=1.0, maximum-scale=1.0, minimal-ui"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("meta")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("http-equiv")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("X-UA-Compatible"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("content")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("IE=edge,chrome=1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("meta")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("http-equiv")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("x-ua-compatible"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("content")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("IE=7,9,10"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("meta")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("viewport"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("content")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("width=device-width, initial-scale=1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("meta")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("http-equiv")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("Content-Type"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("content")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("text/html; charset=UTF-8"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("title")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("id")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("title"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("title")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("head")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("body")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("h1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("Hello flv"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("h1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("button")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token special-attr"}},[a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("onclick")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),a("span",{pre:!0,attrs:{class:"token value javascript language-javascript"}},[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("play")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("播放"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("button")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("button")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token special-attr"}},[a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("onclick")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),a("span",{pre:!0,attrs:{class:"token value javascript language-javascript"}},[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("pause")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("暂停"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("button")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("br")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("br")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("video")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("id")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("videoElement"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("height")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("500"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("width")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("1000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token special-attr"}},[a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("style")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),a("span",{pre:!0,attrs:{class:"token value css language-css"}},[a("span",{pre:!0,attrs:{class:"token property"}},[t._v("border")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("thin solid black")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("controls")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("loop")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("video")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("script")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("src")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("flv.js"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token script"}}),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token script"}},[a("span",{pre:!0,attrs:{class:"token language-javascript"}},[t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" videoElement "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getElementById")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'videoElement'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" flvPlayer "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" flvjs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("createPlayer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("isLive")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'flv'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("url")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://192.168.133.128:80/flvTest?port=20935&app=liveRtmp&stream=room1'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("enableWorker")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("enableStashBuffer")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("stashInitialSize")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("128")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 减少首桢显示等待时长")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        flvPlayer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("attachMediaElement")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("videoElement"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        flvPlayer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("load")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("play")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            flvPlayer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("play")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("pause")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            flvPlayer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("pause")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    ")])]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("body")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("html")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),a("p",[t._v("出现如下页面表示前段播放成功\n"),a("img",{attrs:{src:s(277),alt:""}})]),t._v(" "),a("p",[a("strong",[t._v("方案三：")]),t._v(" 嵌入一个swf媒体播放文件，并利用该文件来播放你预设的文件。这里推荐dplayer——http://dplayer.js.org/zh/guide.html#flv")]),t._v(" "),a("h2",{attrs:{id:"点播"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#点播"}},[t._v("#")]),t._v(" 点播")]),t._v(" "),a("p",[t._v("播放本地视频文件")]),t._v(" "),a("h3",{attrs:{id:"点播实现"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#点播实现"}},[t._v("#")]),t._v(" 点播实现")]),t._v(" "),a("p",[t._v("在nginx已经安装上nginx-http-flv-module模块的基础上进行配置。\n配置nginx.conf")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("events "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    worker_connections  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\nrtmp "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    server "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        listen "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("20935")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        chunk_size "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#单一推流数据包最大容量")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 点播配置")]),t._v("\n        application vod "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n           play /opt/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#//视频文件存放位置。")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("然后在/opt/存放2.mp4，点播地址：rtmp://192.168.133.128:20935/vod/2.mp4，使用VLC播放器直接播放。")]),t._v(" "),a("h2",{attrs:{id:"java操作ffmpeg"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#java操作ffmpeg"}},[t._v("#")]),t._v(" JAVA操作FFmpeg")]),t._v(" "),a("p",[t._v("java操作第三方程序一般需要使用Runtime包，具体代码实现如下")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token import"}},[a("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("cn"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("hutool"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("core"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("util"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("StrUtil")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token import"}},[a("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("lombok"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Cleanup")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token import"}},[a("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("lombok"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("extern"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("slf4j"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Slf4j")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token import"}},[a("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("java"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("io"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("BufferedInputStream")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token import"}},[a("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("java"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("io"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("BufferedReader")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token import"}},[a("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("java"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("io"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("IOException")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token import"}},[a("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("java"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("io"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("InputStreamReader")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n * @description:\n * @author: Tx\n * @date: 2023-04-11  10:27\n */")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Slf4j")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("JavaFFMpegUtil")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("execCmd")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" ffmpegCmd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Thread")]),t._v(" thread "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Thread")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("openFFmpegExe")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ffmpegCmd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            log"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("info")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"结束执行ffmpegCmd：{}"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" ffmpegCmd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        thread"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("start")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("openFFmpegExe")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" ffmpegCmd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("StrUtil")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("isBlank")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ffmpegCmd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Runtime")]),t._v(" rn "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Runtime")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getRuntime")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Process")]),t._v(" p "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            p "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" rn"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("exec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ffmpegCmd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Cleanup")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("BufferedInputStream")]),t._v(" in "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("BufferedInputStream")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("p"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getErrorStream")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Cleanup")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("BufferedReader")]),t._v(" inBr "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("BufferedReader")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("InputStreamReader")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("in"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" lineStr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            log"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("info")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"开始执行ffmpegcmd：{}"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" ffmpegCmd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("while")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("lineStr "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" inBr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("readLine")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                log"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("info")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"执行ffmpegcmd信息：{}"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" lineStr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("catch")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("IOException")]),t._v(" e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("printStackTrace")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            log"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("info")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"openFFmpegExe执行异常：{}"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getMessage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("main")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" args"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("throws")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("InterruptedException")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" ffmpegCmd "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"D:\\\\\\\\software\\\\\\\\ffmpeg\\\\\\\\bin\\\\\\\\ffmpeg.exe  -re -i D:\\\\\\\\2.mp4 -c copy -f flv rtmp://192.168.133.128:20935/liveTest/room1"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('//        String ffmpegCmd = "ffmpeg.exe -re -i rtsp://127.0.0.1:8554/video -rtsp_transport tcp -buffer_size 102400 -vcodec copy -an -f flv rtmp://192.168.133.128:1935/live/room1";')]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("JavaFFMpegUtil")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("execCmd")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ffmpegCmd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h2",{attrs:{id:"几种浏览器播放rtsp视频流解决方案"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#几种浏览器播放rtsp视频流解决方案"}},[t._v("#")]),t._v(" 几种浏览器播放RTSP视频流解决方案")]),t._v(" "),a("p",[t._v("【WebSocket透传】RTSP视频流转换为flv，通过websocket传输flv视频流，然后前端通过websocket获取到视频流后，使用flvjs对视频流再一次处理并进行播放（项目中已使用）\n【协议转换】RTSP转RTMP到RTMP服务器，转http-flv，播放端用flv.js播放（可以使用）\n【协议转换】RTSP转RTMP到RTMP服务器，转hls，播放端用video.js播放（m3u8延迟高）\n【安装插件】VLC或者SmartPlayer第三方插件播放（插件局限）\n【实时通讯技术】RTSP转WebRTC播放（未来趋势）\n【代理服务器】H5 + websocket_rtsp_proxy 实现视频流直播【收费的，免费版有很多限制】")])])}),[],!1,null,null,null);a.default=e.exports}}]);